<%
method ||= :post
shopping_list_presenter = user_shopping_list.presenter.shopping_list_presenter
%>
<main class="form form-shopping-list">
  <%= simple_form_for(user_shopping_list,
                                    url: postback_path,
                                    method: method,
                                    wrapper: :horizontal_form) do |f| %>
    <div class="h1 mb-3 fw-normal">
      <i class="bi <%= header_icon %>"></i>
      <%= header_text %>
    </div>

    <% if f.object.errors[:base].present? %>
      <div class="row mb-3">
        <div class="col-sm-12 col-md-9 col-lg-7">
          <%= render partial: "shared/flash_message",
                      locals: {
                        flash_type: "alert",
                        flash_message: f.object.errors[:base].to_sentence
                      }
          %>
        </div>
      </div>
    <% end %>
    <%= f.simple_fields_for :shopping_list do |shopping_list| %>
      <%= shopping_list.input :shopping_list_name,
              required: true,
              label: "Name",
              autofocus: true
      %>
      <div data-controller="date-picker" data-date-picker-init-date="<%#= shopping_list.display_week_of %>" class="form-inputs">
        <%= shopping_list.input :week_of, as: :string,
                    required: true,
                    input_html: {
                      value: shopping_list_presenter.display_week_of,
                      autocomplete: "off",
                      class: 'datepicker form-control'
                    }
        %>
        <div class="form-group row">
          <%= shopping_list.label :template, class: 'col-sm-2 col-md-2 col-lg-2 col-form-label' %>
          <div class="col-sm-9">
            <%= shopping_list.input :template, as: :boolean, label: false, wrapper: false, class: 'form-check-input' %>
          </div>
        </div>
      </div>
      <%= shopping_list.input :notes %>
    <% end%>

    <!-- Type ahead search -->
    <%= f.input :query,
                label: "Items <abbr title='required'>*</abbr>".html_safe,
                label_html: { class: "required" },
                placeholder: "Search for items to add to your shopping list",
                autocomplete: "off",
                input_html: {
                  data: {
                    action: "input->shopping-list-items#shoppingListItemsSearch",
                    shopping_list_items_target: "input"
                  }
                }
    %>

    <div class="row mb-3">
      <div class="col-sm-2 col-md-2 col-lg-2 col-form-label">
          <%= f.button :submit,
                        submit_button_text,
                        class: "btn btn-primary"
          %>
          <div class="help-links">
            <%= link_to "Back", back_path %>
          </div>
      </div>
      <div data-shopping-list-items-target="results" class="col-sm-10 col-md-7 col-lg-5">
      </div>
    </div>
    <div data-shopping-list-items-target="selectedItemIdsContainer" class="d-none">
    </div>
  <% end %>
</main>
